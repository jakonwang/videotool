{extend name="admin/common/layout" /}

{block name="title"}{if isset($info)}ç¼–è¾‘å¹³å°{else}æ·»åŠ å¹³å°{/if}{/block}
{block name="page_title"}{if isset($info)}ç¼–è¾‘å¹³å°{else}æ·»åŠ å¹³å°{/if}{/block}
{block name="breadcrumb"}<a href="/admin.php/platform" class="text-muted">å¹³å°ç®¡ç†</a> / {if isset($info)}ç¼–è¾‘{else}æ·»åŠ {/if}{/block}
{block name="page_actions"}
<a href="/admin.php/platform" class="btn btn-outline-secondary btn-sm">
    <i class="fas fa-arrow-left mr-1"></i> è¿”å›åˆ—è¡¨
</a>
{/block}

{block name="content"}
<div class="row">
    <div class="col-lg-7 col-xl-6">
        <div class="card shadow-sm">
            <div class="card-body">
                <form id="platform-form" autocomplete="off">
                    {if isset($info)}<input type="hidden" name="id" value="{$info.id}">{/if}
                    <div class="form-group">
                        <label for="name">å¹³å°åç§° <span class="text-danger">*</span></label>
                        <input type="text" id="name" name="name" class="form-control" value="{$info.name|default=''}" required placeholder="ä¾‹å¦‚ï¼šTikTok">
                    </div>
                    <div class="form-group">
                        <label for="code">å¹³å°ä»£ç  <span class="text-danger">*</span></label>
                        <input type="text" id="code" name="code" class="form-control" value="{$info.code|default=''}" {if isset($info)}readonly{/if} required placeholder="ä¾‹å¦‚ï¼štiktok">
                        <small class="form-text text-muted">ä»£ç ç”¨äº API è°ƒç”¨ï¼Œåˆ›å»ºåä¸å¯ä¿®æ”¹ã€‚</small>
                    </div>
                    <div class="form-group">
                        <label for="icon">å›¾æ ‡</label>
                        <input type="text" id="icon" name="icon" class="form-control" value="{$info.icon|default=''}" placeholder="ä¾‹å¦‚ï¼šğŸµ æˆ– FontAwesome å›¾æ ‡">
                        <small class="form-text text-muted">æ”¯æŒ emoji æˆ–è‡ªå®šä¹‰ HTMLã€‚</small>
                    </div>
                    <div class="form-group">
                        <label for="status">çŠ¶æ€</label>
                        <select id="status" name="status" class="form-control">
                            <option value="1" {if isset($info) && $info.status == 1}selected{/if}>å¯ç”¨</option>
                            <option value="0" {if isset($info) && $info.status == 0}selected{/if}>ç¦ç”¨</option>
                        </select>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save mr-1"></i> ä¿å­˜
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{/block}

{block name="script"}
<script>
    $(function () {
        $('#platform-form').on('submit', function (event) {
            event.preventDefault();
            const $form = $(this);
            const submitBtn = $form.find('button[type="submit"]');
            const originalHtml = submitBtn.html();

            submitBtn.prop('disabled', true).html('<span class="spinner-border spinner-border-sm mr-1" role="status"></span>ä¿å­˜ä¸­');

            const url = {if isset($info)}'/admin.php/platform/edit/{$info.id}'{else}'/admin.php/platform/add'{/if};
            $.post(url, $form.serialize())
                .done(function (res) {
                    if (res.code === 0) {
                        AdminUI.showToast('success', res.msg || 'ä¿å­˜æˆåŠŸ');
                        setTimeout(() => window.location.href = '/admin.php/platform', 1000);
                    } else {
                        AdminUI.showToast('error', res.msg || 'ä¿å­˜å¤±è´¥');
                    }
                })
                .fail(function () {
                    AdminUI.showToast('error', 'ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
                })
                .always(function () {
                    submitBtn.prop('disabled', false).html(originalHtml);
                });
        });
    });
</script>
{/block}
